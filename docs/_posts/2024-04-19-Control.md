---
title: "Control"
last_modified_at: 2024-04-29T13:06:00
categories:
  - Blog
tags:
  - PID
  - Redes neuronales
---

Implementaremos una solución combinando múltiples redes neuronales para detectar el carril y calcular la desviación del vehículo respecto al mismo. Esta información se enviará a un controlador PID para corregir la desviación y mantener al vehículo en adecuadamente en el centro del carril.

## Detección de carril

Buscamos seleccionar un entorno con una única vía, rodeado de vegetación y con un cielo despejado, con el objetivo de minimizar la confusión entre el cielo, la carretera y los edificios.

### Red neuronal de segmentación semántica

Filtramos la salida de la red de segmentación para aislar el área correspondiente a la calzada y calculamos el centro de masas de la calzada. Determinamos la desviación del carril como la diferencia en el eje *x* entre el centro de masas y el centro de la imagen, que se alinea con el centro del vehículo.
<figure class="align-center" style="max-width: 100%">
  <img src="{{ site.url }}{{ site.baseurl }}/images/control/seg.png" alt="">
</figure>

### Red neuronal de detección de carril

Esta red neuronal detecta las lineas tanto derecha como izquierda del carril. Para mejorar la eficiencia, ejecutaremos esta red en un hilo, mientras la de segmentacion corre en el hilo principal. Para activar esta red hemos añadido una nueva flag a la camaera *lane*.
<figure class="align-center" style="max-width: 100%">
  <img src="{{ site.url }}{{ site.baseurl }}/images/control/lane.png" alt="">
</figure>

Para calcular la el centro de msas, tendremos en cuenta solo los pixeles de la calzada que estan dentero de los limites del carril. Para ello, obtenemos de cada fila el pixel mas a derecha y mas a la izquierda del carril, 
<figure class="align-center" style="max-width: 100%">
  <img src="{{ site.url }}{{ site.baseurl }}/images/control/seg_lane.png" alt="">
</figure>

## Controlador PID